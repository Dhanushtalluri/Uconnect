<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weekly Challenges - Practical Knowledge Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap 5 CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f8faff;
      color: #1a237e;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      padding-top: 60px;
    }
    .card-title {
      font-weight: 700;
      color: #283593;
    }
    .btn-primary {
      background-color: #1a237e;
      border: none;
    }
    .btn-primary:hover {
      background-color: #283593;
    }
    .header {
      background-color: #1a237e;
      color: white;
      padding: 1rem;
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1030;
    }
    .header h1 {
      margin: 0;
      font-weight: 700;
    }
    .container {
      max-width: 900px;
    }
    .deadline {
      font-size: 0.9rem;
      color: #d32f2f;
      font-weight: 600;
    }
  </style>
</head>
<body>

  <header class="header d-flex justify-content-center align-items-center">
    <h1>Weekly Challenges</h1>
  </header>

  <main class="container mt-4">

    <div id="challenges-list" class="row gy-4">
      <!-- Challenge cards will be inserted here by JS -->
    </div>

  </main>

  <!-- Firebase JS SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore-compat.js"></script>

  <script>
    // Your web app's Firebase configuration
    // Replace below with your project's config object from Firebase console
   // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBjiKldk4Q-J8dEbhBd6FTGyPb-TQoGadE",
  authDomain: "st-fees.firebaseapp.com",
  projectId: "st-fees",
  storageBucket: "st-fees.firebasestorage.app",
  messagingSenderId: "865723388538",
  appId: "1:865723388538:web:e49e6bde9ff7023aae61c3",
  measurementId: "G-Y9WQXHKTX4"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Utility function to format dates nicely
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      if (isNaN(d)) return dateStr;
      return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
    }

    // Render challenge card
    function createChallengeCard(challenge) {
      const col = document.createElement('div');
      col.className = 'col-md-6';

      const card = document.createElement('div');
      card.className = 'card shadow-sm';

      const cardBody = document.createElement('div');
      cardBody.className = 'card-body d-flex flex-column';

      const title = document.createElement('h5');
      title.className = 'card-title';
      title.textContent = challenge.title;

      const desc = document.createElement('p');
      desc.className = 'card-text mt-2 flex-grow-1';
      desc.textContent = challenge.description;

      const deadline = document.createElement('p');
      deadline.className = 'deadline mt-2';
      deadline.textContent = `Deadline: ${formatDate(challenge.deadline)}`;

      const btn = document.createElement('button');
      btn.className = 'btn btn-primary mt-3 align-self-start';
      btn.textContent = 'Submit Solution';
      btn.onclick = () => window.location.href = `submit.html?title=${encodeURIComponent(challenge.title)}`;

      cardBody.appendChild(title);
      cardBody.appendChild(desc);
      cardBody.appendChild(deadline);
      cardBody.appendChild(btn);

      card.appendChild(cardBody);
      col.appendChild(card);

      return col;
    }

    // Fetch and display challenges from Firestore collection "weeklyChallenges"
    function loadChallenges() {
      const challengesList = document.getElementById('challenges-list');
      challengesList.innerHTML = '<p class="text-center text-muted">Loading challenges...</p>';

      db.collection('weeklyChallenges')
        .orderBy('deadline', 'asc')
        .get()
        .then(snapshot => {
          challengesList.innerHTML = '';
          if (snapshot.empty) {
            challengesList.innerHTML = '<p class="text-center text-muted">No challenges available currently.</p>';
            return;
          }
          snapshot.forEach(doc => {
            const challenge = doc.data();
            challengesList.appendChild(createChallengeCard(challenge));
          });
        })
        .catch(err => {
          console.error('Error fetching challenges', err);
          challengesList.innerHTML = '<p class="text-danger text-center">Failed to load challenges. Try again later.</p>';
        });
    }

    // Load on page load
    window.onload = loadChallenges;
  </script>

  <!-- Bootstrap 5 JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
